Note about UML diagram:
Unfortunetely, I couldn't describe all classes and their relationships, so I simplify diagram by adding main dependencies and I also left some hints in UML about what class aggregates(note private getters).
I also didn't put exceptions and some services, they don't inherit anything, and goes as utility.